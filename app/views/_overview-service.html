<div ng-if="!(visibleDeploymentsByConfig | hashSize) && !(monopods | hashSize)" class="no-deployments-block">
  <h2>No deployments.</h2>
  <p>
    There are no deployments or pods for service
    <a ng-href="{{service | navigateResourceURL}}">{{service.metadata.name}}</a>.
  </p>
</div>

<div class="deployment-tile" ng-repeat="(dcName, deployments) in visibleDeploymentsByConfig">
  <!-- visible deployments with a dc -->
  <div ng-if="dcName.length" ng-init="activeDeployment = (deployments | getActiveDeployment)">
    <div row class="service-title">
      <div>
        Service:
        <a ng-href="{{service | navigateResourceURL}}">{{service.metadata.name}}</a>
      </div>
      <div>
        <relative-timestamp timestamp="activeDeployment.metadata.creationTimestamp"></relative-timestamp>
      </div>
    </div>
    <div class="deployment-header">
      <div column flex class="shield">
        <a ng-href="{{activeDeployment | navigateResourceURL}}">
          <span class="shield-number">#{{activeDeployment | annotation: 'deploymentVersion'}}</span>
        </a>
      </div>
    </div>
    <div row class="deployment-body">
      <!-- all visible deployments -->
      <div column class="overview-donut"
          ng-repeat="deployment in deployments | orderObjectsByDate : true track by (deployment | uid)"
          ng-class="isDeploymentLatest(deployment) ? 'latest' : ''">
        <deployment-donut
            rc="deployment"
            deployment-config="deploymentConfigs[dcName]"
            pods="podsByDeployment[deployment.metadata.name]"
            hpa="getHPA(deployment.metadata.name, dcName)"
            limit-ranges="limitRanges"
            scalable="isScalableDeployment(deployment, deploymentConfigs, hpaByDc, hpaByRc, scalableDeploymentByConfig)"
            alerts="alerts">
        </deployment-donut>
      </div>
      <!-- /all visible deployments -->
      <!-- connecting arrow -->
      <div column class="overview-donut-connector" ng-if="(deployments | anyDeploymentIsInProgress)">
        <div ng-if="deployments.length > 1">
          &rarr;
          <span>deploying...</span>
        </div>
      </div>
      <!-- /connecting arrow -->
      <!-- metrics or pod template -->
      <div column class="overview-metrics" ng-if="!(deployments | anyDeploymentIsInProgress)">
        <metrics ng-if="showMetrics" deployment="activeDeployment" profile="compact"></metrics>
        <div ng-if="!showMetrics">
          <pod-template pod-template="activeDeployment.spec.template"></pod-template>
        </div>
      </div>
      <!-- /metrics or pod template -->
    </div>
  </div>
  <!-- /visible deployments with a dc -->

  <!-- visible deployments without a dc -->
  <div ng-if="!dcName.length" ng-repeat="deployment in deployments | orderObjectsByDate : true track by (deployment | uid)">
    <div row class="service-title">
      <div>
        Service:
        <a ng-href="{{service | navigateResourceURL}}">{{service.metadata.name}}</a>
      </div>
      <div>
        <relative-timestamp timestamp="deployment.metadata.creationTimestamp"></relative-timestamp>
      </div>
    </div>
    <div class="deployment-header">
      <div row class="rc-header">
        <a ng-href="{{deployment | navigateResourceURL}}">{{deployment.metadata.name}}</a>
      </div>
    </div>
    <div row class="deployment-body">
      <!-- all visible deployments -->
      <div column class="overview-donut" ng-class="isDeploymentLatest(deployment) ? 'latest' : ''">
        <deployment-donut
            rc="deployment"
            deployment-config="deploymentConfigs[dcName]"
            pods="podsByDeployment[deployment.metadata.name]"
            hpa="getHPA(deployment.metadata.name, dcName)"
            limit-ranges="limitRanges"
            scalable="isScalableDeployment(deployment, deploymentConfigs, hpaByDc, hpaByRc, scalableDeploymentByConfig)"
            alerts="alerts">
        </deployment-donut>
      </div>
      <!-- /all visible deployments -->
      <!-- metrics or pod template -->
      <div column class="overview-metrics">
        <metrics ng-if="showMetrics" deployment="deployment" profile="compact"></metrics>
        <div ng-if="!showMetrics">
          <pod-template pod-template="deployment.spec.template"></pod-template>
        </div>
      </div>
      <!-- /metrics or pod template -->
    </div>
  </div>
</div>

<!-- monopods -->
<div ng-repeat="pod in monopods | orderObjectsByDate : true track by (pod | uid)"
     class="deployment-tile">
  <div row class="service-title">
    <div>
      Service:
      <a ng-href="{{service | navigateResourceURL}}">{{service.metadata.name}}</a>
    </div>
    <div>
      <relative-timestamp timestamp="pod.metadata.creationTimestamp"></relative-timestamp>
    </div>
  </div>
  <div row class="rc-header"> <!-- TODO may want different treatment for a pod-name? -->
    <a ng-href="{{pod | navigateResourceURL}}">{{pod.metadata.name}}</a>
  </div>
  <div row class="deployment-body">
    <div column class="overview-donut">
      <pod-donut pods="[pod]"></pod-donut>
    </div>
    <div column class="overview-metrics">
      <metrics pod="pod" profile="compact"></metrics>
    </div>
  </div>
</div>
<!-- /monopods -->
